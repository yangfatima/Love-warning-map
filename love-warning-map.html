<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…¨çƒæ‹çˆ±é¿é›·åœ°å›¾ Â· Love Danger Zone</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@300;400;500&display=swap');
  :root{--deep:#020b18;--cyan:#00d4ff;--pink:#ff4d8d;--purple:#b44dff;--gold:#ffd700;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--deep);font-family:'Noto Sans SC',sans-serif;overflow:hidden;height:100vh;width:100vw;cursor:crosshair;}
  #starfield{position:fixed;inset:0;z-index:0;pointer-events:none;}
  .scanlines{position:fixed;inset:0;z-index:50;pointer-events:none;background:repeating-linear-gradient(to bottom,transparent 0,transparent 2px,rgba(0,0,0,0.04) 2px,rgba(0,0,0,0.04) 4px);}
  .corner{position:fixed;width:44px;height:44px;z-index:100;pointer-events:none;}
  .corner::before,.corner::after{content:'';position:absolute;background:rgba(0,212,255,0.55);}
  .corner::before{width:2px;height:100%;}.corner::after{width:100%;height:2px;}
  .tl{top:14px;left:14px;}.tr{top:14px;right:14px;transform:scaleX(-1);}
  .bl{bottom:14px;left:14px;transform:scaleY(-1);}.br{bottom:14px;right:14px;transform:scale(-1);}

  /* TITLE */
  .title{position:fixed;top:22px;left:50%;transform:translateX(-50%);z-index:100;text-align:center;pointer-events:none;}
  .title h1{font-family:'Orbitron',sans-serif;font-size:clamp(12px,2vw,21px);font-weight:900;color:var(--cyan);letter-spacing:6px;text-shadow:0 0 20px var(--cyan),0 0 50px rgba(0,212,255,0.3);white-space:nowrap;}
  .title p{font-size:10px;color:rgba(0,212,255,0.4);letter-spacing:3px;margin-top:3px;}

  /* STATS */
  .stats-bar{position:fixed;top:22px;left:22px;z-index:100;display:flex;flex-direction:column;gap:7px;}
  .stat-item{display:flex;align-items:center;gap:7px;font-size:11px;color:rgba(0,212,255,0.65);letter-spacing:1px;}
  .stat-dot{width:6px;height:6px;border-radius:50%;background:var(--pink);box-shadow:0 0 8px var(--pink);animation:pulse 2s infinite;}
  .stat-dot.live{background:var(--cyan);box-shadow:0 0 8px var(--cyan);}
  .stat-num{font-family:'Orbitron',sans-serif;font-size:13px;color:#fff;}

  /* LEGEND */
  .legend{position:fixed;top:22px;right:22px;z-index:100;display:flex;flex-direction:column;gap:6px;}
  .legend-item{display:flex;align-items:center;gap:7px;font-size:10px;color:rgba(255,255,255,0.5);letter-spacing:1px;}
  .legend-dot{width:8px;height:8px;border-radius:50%;}

  /* MAP */
  #map-container{position:fixed;inset:0;z-index:1;display:flex;align-items:center;justify-content:center;overflow:hidden;}
  #map-wrapper{width:90vw;max-width:1300px;transform-origin:center center;will-change:transform;cursor:grab;}
  #map-wrapper:active{cursor:grabbing;}
  #map-wrapper.smooth{transition:transform 1s cubic-bezier(0.25,0.46,0.45,0.94);}
  #world-svg{width:100%;height:auto;display:block;filter:drop-shadow(0 0 30px rgba(0,100,200,0.3));}

  /* ZOOM CONTROLS */
  .zoom-controls{position:fixed;bottom:30px;left:30px;z-index:100;display:flex;flex-direction:column;gap:6px;}
  .zoom-btn{width:34px;height:34px;border-radius:8px;border:1px solid rgba(0,212,255,0.3);background:rgba(0,20,50,0.85);color:rgba(0,212,255,0.8);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;backdrop-filter:blur(8px);}
  .zoom-btn:hover{border-color:rgba(0,212,255,0.8);color:#fff;box-shadow:0 0 14px rgba(0,212,255,0.3);}

  /* DANMU CANVAS */
  #danmu-canvas{position:fixed;inset:0;z-index:60;pointer-events:none;overflow:hidden;}
  .danmu{position:absolute;white-space:nowrap;font-size:11px;letter-spacing:1.5px;color:rgba(0,212,255,0.55);border:1px solid rgba(0,212,255,0.18);background:rgba(0,12,35,0.55);padding:4px 12px;border-radius:20px;backdrop-filter:blur(4px);pointer-events:none;}
  .danmu.pink{color:rgba(255,100,150,0.72);border-color:rgba(255,77,141,0.25);}
  .danmu.gold{color:rgba(255,210,0,0.65);border-color:rgba(255,215,0,0.2);}
  .danmu.vert{writing-mode:vertical-rl;font-size:10px;padding:10px 4px;letter-spacing:2.5px;}

  /* SHARE */
  .share-btn{position:fixed;bottom:30px;right:30px;z-index:100;cursor:pointer;}
  .share-inner{display:inline-flex;align-items:center;gap:10px;padding:12px 22px;border:1px solid rgba(0,212,255,0.4);border-radius:30px;background:rgba(0,20,52,0.88);backdrop-filter:blur(12px);transition:all 0.3s;}
  .share-btn:hover .share-inner{border-color:rgba(0,212,255,0.9);box-shadow:0 0 24px rgba(0,212,255,0.35);transform:translateY(-2px);}
  .share-icon{font-size:16px;animation:pulse 2s infinite;}
  .share-text{font-size:13px;color:var(--cyan);letter-spacing:1.5px;font-weight:500;text-shadow:0 0 10px rgba(0,212,255,0.5);}

  /* MODAL */
  .modal-overlay{position:fixed;inset:0;z-index:1000;background:rgba(0,6,22,0.9);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.35s;}
  .modal-overlay.active{opacity:1;pointer-events:all;}
  .modal{background:linear-gradient(145deg,rgba(4,16,44,0.99),rgba(2,8,26,0.99));border:1px solid rgba(0,212,255,0.25);border-radius:22px;padding:34px;width:min(92vw,480px);max-height:90vh;overflow-y:auto;box-shadow:0 0 60px rgba(0,70,200,0.18);transform:scale(0.88) translateY(16px);transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1);}
  .modal-overlay.active .modal{transform:scale(1) translateY(0);}
  .modal-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px;}
  .modal-title{font-family:'Orbitron',sans-serif;font-size:14px;color:var(--cyan);letter-spacing:3px;}
  .modal-sub{font-size:10px;color:rgba(255,255,255,0.32);letter-spacing:1px;margin-top:4px;}
  .modal-x{width:28px;height:28px;border-radius:50%;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.04);color:rgba(255,255,255,0.5);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.2s;}
  .modal-x:hover{border-color:var(--pink);color:var(--pink);}
  .fsec{margin-bottom:18px;}
  .flbl{font-size:10px;color:rgba(0,212,255,0.6);letter-spacing:2px;margin-bottom:8px;display:block;text-transform:uppercase;}
  .ggroup{display:flex;gap:10px;}
  .gbtn{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.4);font-size:13px;cursor:pointer;transition:all 0.2s;letter-spacing:2px;font-family:'Noto Sans SC',sans-serif;}
  .gbtn:hover{border-color:rgba(0,212,255,0.4);color:rgba(255,255,255,0.8);}
  .gbtn.sel{border-color:var(--pink);background:rgba(255,77,141,0.1);color:var(--pink);}
  .egrid{display:grid;grid-template-columns:1fr 1fr;gap:7px;}
  .ebtn{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.09);background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.4);font-size:12px;cursor:pointer;transition:all 0.2s;letter-spacing:1px;font-family:'Noto Sans SC',sans-serif;}
  .ebtn:hover{border-color:rgba(180,77,255,0.4);color:rgba(255,255,255,0.8);}
  .ebtn.sel{border-color:var(--purple);background:rgba(180,77,255,0.1);color:var(--purple);}
  .fsel{width:100%;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.12);background:rgba(2,10,34,0.9);color:rgba(255,255,255,0.8);font-size:13px;font-family:'Noto Sans SC',sans-serif;cursor:pointer;outline:none;transition:all 0.2s;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2300d4ff' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;}
  .fsel:focus{border-color:rgba(0,212,255,0.5);}
  .fsel option{background:#030d1f;}
  .subbtn{width:100%;padding:14px;border-radius:12px;border:none;background:linear-gradient(135deg,#0a4fa8,#0066cc);color:#fff;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:3px;cursor:pointer;transition:all 0.3s;margin-top:22px;overflow:hidden;position:relative;}
  .subbtn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.15),transparent);transition:left 0.4s;}
  .subbtn:hover{box-shadow:0 0 28px rgba(0,100,255,0.5);transform:translateY(-1px);}
  .subbtn:hover::before{left:100%;}

  /* NOTIFICATION */
  .notif{position:fixed;bottom:88px;left:50%;transform:translateX(-50%) translateY(14px);background:rgba(0,20,52,0.94);border:1px solid rgba(0,212,255,0.4);border-radius:20px;padding:9px 22px;font-size:12px;color:var(--cyan);letter-spacing:1.5px;z-index:200;opacity:0;transition:all 0.4s;pointer-events:none;white-space:nowrap;}
  .notif.show{opacity:1;transform:translateX(-50%) translateY(0);}

  /* TOOLTIP */
  .tip{position:fixed;background:rgba(0,12,40,0.97);border:1px solid rgba(0,212,255,0.28);border-radius:8px;padding:7px 13px;font-size:11px;color:var(--cyan);letter-spacing:1px;pointer-events:none;z-index:500;opacity:0;transition:opacity 0.2s;white-space:nowrap;}

  /* ZOOM HINT */
  .zhint{position:fixed;bottom:78px;left:50%;transform:translateX(-50%);font-size:10px;color:rgba(0,212,255,0.3);letter-spacing:2px;z-index:100;pointer-events:none;transition:opacity 1s;}

  @keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.45;transform:scale(0.8);}}
</style>
</head>
<body>

<canvas id="starfield"></canvas>
<div class="scanlines"></div>
<div class="corner tl"></div><div class="corner tr"></div>
<div class="corner bl"></div><div class="corner br"></div>
<div id="danmu-canvas"></div>

<div class="title">
  <h1>âš¡ LOVE DANGER ZONE âš¡</h1>
  <p>å…¨çƒæ‹çˆ±é¿é›·åœ°å›¾ Â· GLOBAL WARNING SYSTEM</p>
</div>

<div class="stats-bar">
  <div class="stat-item"><div class="stat-dot"></div><span>å®æ—¶é¿é›·æ•°æ®</span></div>
  <div class="stat-item"><div class="stat-dot live"></div><span>å…¨çƒæŠ•ç¥¨ <span class="stat-num" id="total-count">2847</span></span></div>
  <div class="stat-item"><div class="stat-dot"></div><span>ä»Šæ—¥æ–°å¢ <span class="stat-num" id="today-count">138</span></span></div>
</div>

<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:#ff4d8d;box-shadow:0 0 7px #ff4d8d"></div><span>é«˜å±åŒºåŸŸ</span></div>
  <div class="legend-item"><div class="legend-dot" style="background:#ff9500;box-shadow:0 0 7px #ff9500"></div><span>ä¸­åº¦é¢„è­¦</span></div>
  <div class="legend-item"><div class="legend-dot" style="background:#ffd700;box-shadow:0 0 7px #ffd700"></div><span>è½»åº¦é£é™©</span></div>
  <div class="legend-item"><div class="legend-dot" style="background:#00d4ff;box-shadow:0 0 7px #00d4ff"></div><span>æ•°æ®ç¨€å°‘</span></div>
  <div class="legend-item" style="margin-top:5px;color:rgba(0,212,255,0.3);font-size:9px;">æ»šè½®ç¼©æ”¾ Â· æ‹–æ‹½å¹³ç§»</div>
</div>

<div id="map-container">
  <div id="map-wrapper">
    <svg id="world-svg" viewBox="0 0 1000 500" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="bg" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#051a3d"/>
          <stop offset="70%" stop-color="#020b18"/>
          <stop offset="100%" stop-color="#010509"/>
        </radialGradient>
        <filter id="glow" x="-60%" y="-60%" width="220%" height="220%">
          <feGaussianBlur stdDeviation="3" result="b"/>
          <feComposite in="SourceGraphic" in2="b" operator="over"/>
        </filter>
        <filter id="sglow" x="-120%" y="-120%" width="340%" height="340%">
          <feGaussianBlur stdDeviation="8" result="b"/>
          <feComposite in="SourceGraphic" in2="b" operator="over"/>
        </filter>
        <filter id="mglow" x="-250%" y="-250%" width="600%" height="600%">
          <feGaussianBlur stdDeviation="18" result="b"/>
          <feComposite in="SourceGraphic" in2="b" operator="over"/>
        </filter>
      </defs>
      <rect width="1000" height="500" fill="url(#bg)" rx="8"/>
      <g opacity="0.065" stroke="#00d4ff" stroke-width="0.5" fill="none">
        <line x1="0" y1="83" x2="1000" y2="83"/><line x1="0" y1="166" x2="1000" y2="166"/>
        <line x1="0" y1="250" x2="1000" y2="250"/><line x1="0" y1="333" x2="1000" y2="333"/>
        <line x1="0" y1="416" x2="1000" y2="416"/>
        <line x1="111" y1="0" x2="111" y2="500"/><line x1="222" y1="0" x2="222" y2="500"/>
        <line x1="333" y1="0" x2="333" y2="500"/><line x1="444" y1="0" x2="444" y2="500"/>
        <line x1="556" y1="0" x2="556" y2="500"/><line x1="667" y1="0" x2="667" y2="500"/>
        <line x1="778" y1="0" x2="778" y2="500"/><line x1="889" y1="0" x2="889" y2="500"/>
      </g>
      <g id="countries" fill="rgba(5,30,80,0.72)" stroke="#1a5fa8" stroke-width="0.7" stroke-linejoin="round">
        <path class="country" data-country="ç¾å›½"       d="M155,120 L270,100 L290,115 L285,145 L260,160 L250,180 L225,185 L200,175 L175,165 L160,150 Z"/>
        <path class="country" data-country="åŠ æ‹¿å¤§"     d="M130,60 L290,50 L295,100 L270,100 L155,120 L140,95 L125,80 Z"/>
        <path class="country" data-country="å¢¨è¥¿å“¥"     d="M170,185 L225,185 L235,215 L210,225 L185,220 L165,205 Z"/>
        <path class="country" data-country="å·´è¥¿"       d="M245,230 L310,225 L325,270 L310,320 L280,345 L255,330 L240,300 L235,265 Z"/>
        <path class="country" data-country="é˜¿æ ¹å»·"     d="M255,330 L280,345 L278,390 L260,410 L245,390 L248,355 Z"/>
        <path class="country" data-country="è‹±å›½"       d="M445,95 L455,90 L458,110 L448,115 L442,108 Z"/>
        <path class="country" data-country="æ³•å›½"       d="M450,115 L472,112 L478,130 L460,140 L448,130 Z"/>
        <path class="country" data-country="å¾·å›½"       d="M472,100 L492,98 L496,115 L472,118 L468,105 Z"/>
        <path class="country" data-country="è¥¿ç­ç‰™"     d="M442,135 L468,132 L470,148 L450,155 L438,148 Z"/>
        <path class="country" data-country="æ„å¤§åˆ©"     d="M472,130 L488,128 L490,155 L480,168 L470,155 L468,140 Z"/>
        <path class="country" data-country="ä¿„ç½—æ–¯"     d="M490,60 L750,55 L760,100 L700,110 L600,115 L520,110 L492,95 Z"/>
        <path class="country" data-country="åœŸè€³å…¶"     d="M490,128 L530,125 L533,142 L490,145 Z"/>
        <path class="country" data-country="æ²™ç‰¹é˜¿æ‹‰ä¼¯" d="M510,165 L545,162 L548,195 L525,205 L508,195 Z"/>
        <path class="country" data-country="åŸƒåŠ"       d="M490,165 L515,163 L518,185 L490,188 Z"/>
        <path class="country" data-country="å°¼æ—¥åˆ©äºš"   d="M455,215 L490,212 L495,245 L465,255 L450,240 Z"/>
        <path class="country" data-country="å—é"       d="M470,315 L510,312 L515,350 L488,365 L465,348 Z"/>
        <path class="country" data-country="ä¸­å›½"       d="M665,120 L780,115 L790,155 L760,175 L700,180 L665,170 L655,145 Z"/>
        <path class="country" data-country="å°åº¦"       d="M600,165 L650,162 L658,215 L630,240 L605,220 L595,190 Z"/>
        <path class="country" data-country="æ³°å›½"       d="M685,195 L705,192 L708,220 L690,230 L680,215 Z"/>
        <path class="country" data-country="è¶Šå—"       d="M718,185 L730,182 L732,220 L718,228 L712,210 Z"/>
        <path class="country" data-country="è²å¾‹å®¾"     d="M770,200 L785,195 L788,230 L772,235 L765,218 Z"/>
        <path class="country" data-country="æ—¥æœ¬"       d="M800,128 L815,122 L820,148 L805,155 L798,140 Z"/>
        <path class="country" data-country="éŸ©å›½"       d="M785,135 L800,133 L802,148 L786,150 Z"/>
        <path class="country" data-country="æ¾³å¤§åˆ©äºš"   d="M760,295 L850,288 L870,345 L840,380 L785,375 L758,340 Z"/>
      </g>
      <g fill="rgba(0,212,255,0.28)" font-size="6" font-family="Orbitron" text-anchor="middle" pointer-events="none">
        <text x="215" y="152">USA</text><text x="213" y="72">CANADA</text>
        <text x="714" y="150">CHINA</text><text x="625" y="205">INDIA</text>
        <text x="808" y="140">JPN</text><text x="793" y="142">KR</text>
        <text x="618" y="80">RUSSIA</text><text x="462" y="126">FR</text>
        <text x="812" y="338">AUS</text><text x="197" y="210">MEX</text>
      </g>
      <g id="heat-layer"></g>
      <g id="map-stars" opacity="0.45"></g>
      <g id="flash-layer"></g>
    </svg>
  </div>
</div>

<div class="zoom-controls">
  <button class="zoom-btn" onclick="manualZoom(1.45)">+</button>
  <button class="zoom-btn" onclick="manualZoom(1/1.45)" style="font-size:15px;">âˆ’</button>
  <button class="zoom-btn" onclick="resetZoom()" style="font-size:11px;">â†º</button>
</div>
<div class="zhint" id="zhint">æ»šè½®ç¼©æ”¾ Â· æ‹–æ‹½å¹³ç§» Â· æäº¤åè‡ªåŠ¨é£è‡³åŸå¸‚</div>

<div class="share-btn" onclick="openModal()">
  <div class="share-inner">
    <span class="share-icon">ğŸ’¢</span>
    <span class="share-text">åˆ†äº«ä½ çš„æ‹çˆ±é¿é›·åæ ‡</span>
  </div>
</div>

<div class="modal-overlay" id="modal">
  <div class="modal">
    <div class="modal-hd">
      <div>
        <div class="modal-title">âš¡ æŠ•é€’é¿é›·åæ ‡</div>
        <div class="modal-sub">æäº¤ååœ°å›¾å°†è‡ªåŠ¨æ—‹è½¬é£è‡³ç›®æ ‡åŸå¸‚</div>
      </div>
      <button class="modal-x" onclick="closeModal()">âœ•</button>
    </div>
    <div class="fsec">
      <label class="flbl">â–¸ æ¸£ç”· / æ¸£å¥³ æ€§åˆ«</label>
      <div class="ggroup">
        <button class="gbtn" onclick="selectGender('ç”·')" id="btn-male">â™‚ æ¸£ç”·</button>
        <button class="gbtn" onclick="selectGender('å¥³')" id="btn-female">â™€ æ¸£å¥³</button>
      </div>
    </div>
    <div class="fsec">
      <label class="flbl">â–¸ äº‹ä»¶ç±»å‹</label>
      <div class="egrid">
        <button class="ebtn" onclick="selectEvent('å¤±è”')" id="ev-lost">ğŸ‘» çªç„¶å¤±è”</button>
        <button class="ebtn" onclick="selectEvent('æš§æ˜§å¤šçº¿')" id="ev-multi">ğŸ’” æš§æ˜§å¤šçº¿</button>
        <button class="ebtn" onclick="selectEvent('ç”»é¥¼')" id="ev-pie">ğŸ¥§ ç”»å¤§é¥¼</button>
        <button class="ebtn" onclick="selectEvent('å·²è¯»ä¸å›')" id="ev-read">ğŸ“µ å·²è¯»ä¸å›</button>
        <button class="ebtn" onclick="selectEvent('PUA')" id="ev-pua">ğŸ­ PUA æ“æ§</button>
        <button class="ebtn" onclick="selectEvent('åˆ†æ‰‹ç”©é”…')" id="ev-blame">ğŸŒ€ åˆ†æ‰‹ç”©é”…</button>
      </div>
    </div>
    <div class="fsec">
      <label class="flbl">â–¸ æ‰€åœ¨å›½å®¶ / åœ°åŒº</label>
      <select class="fsel" id="sel-country" onchange="onCountryChange()">
        <option value="">â€” é€‰æ‹©å›½å®¶ â€”</option>
        <option value="ä¸­å›½">ğŸ‡¨ğŸ‡³ ä¸­å›½</option>
        <option value="ç¾å›½">ğŸ‡ºğŸ‡¸ ç¾å›½</option>
        <option value="æ—¥æœ¬">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
        <option value="éŸ©å›½">ğŸ‡°ğŸ‡· éŸ©å›½</option>
        <option value="è‹±å›½">ğŸ‡¬ğŸ‡§ è‹±å›½</option>
        <option value="æ³•å›½">ğŸ‡«ğŸ‡· æ³•å›½</option>
        <option value="å¾·å›½">ğŸ‡©ğŸ‡ª å¾·å›½</option>
        <option value="æ„å¤§åˆ©">ğŸ‡®ğŸ‡¹ æ„å¤§åˆ©</option>
        <option value="è¥¿ç­ç‰™">ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™</option>
        <option value="ä¿„ç½—æ–¯">ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯</option>
        <option value="å°åº¦">ğŸ‡®ğŸ‡³ å°åº¦</option>
        <option value="æ³°å›½">ğŸ‡¹ğŸ‡­ æ³°å›½</option>
        <option value="è¶Šå—">ğŸ‡»ğŸ‡³ è¶Šå—</option>
        <option value="è²å¾‹å®¾">ğŸ‡µğŸ‡­ è²å¾‹å®¾</option>
        <option value="æ¾³å¤§åˆ©äºš">ğŸ‡¦ğŸ‡º æ¾³å¤§åˆ©äºš</option>
        <option value="å·´è¥¿">ğŸ‡§ğŸ‡· å·´è¥¿</option>
        <option value="é˜¿æ ¹å»·">ğŸ‡¦ğŸ‡· é˜¿æ ¹å»·</option>
        <option value="åŠ æ‹¿å¤§">ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§</option>
        <option value="åœŸè€³å…¶">ğŸ‡¹ğŸ‡· åœŸè€³å…¶</option>
        <option value="å—é">ğŸ‡¿ğŸ‡¦ å—é</option>
        <option value="å¢¨è¥¿å“¥">ğŸ‡²ğŸ‡½ å¢¨è¥¿å“¥</option>
      </select>
    </div>
    <div class="fsec">
      <label class="flbl">â–¸ åŸå¸‚</label>
      <select class="fsel" id="sel-city"><option value="">â€” è¯·å…ˆé€‰æ‹©å›½å®¶ â€”</option></select>
    </div>
    <button class="subbtn" onclick="submitReport()">âš¡ æŠ•é€’åæ ‡ Â· SUBMIT COORDINATES</button>
  </div>
</div>

<div class="tip" id="tip"></div>
<div class="notif" id="notif"></div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const cityData={
  'ä¸­å›½':['åŒ—äº¬','ä¸Šæµ·','å¹¿å·','æ·±åœ³','æˆéƒ½','æ­å·','æ­¦æ±‰','è¥¿å®‰','å—äº¬','é‡åº†','å¤©æ´¥','é’å²›','å¦é—¨','è‹å·','é•¿æ²™','æ²ˆé˜³','éƒ‘å·','å“ˆå°”æ»¨'],
  'ç¾å›½':['çº½çº¦','æ´›æ‰çŸ¶','æ—§é‡‘å±±','èŠåŠ å“¥','è¿ˆé˜¿å¯†','è¥¿é›…å›¾','æ³¢å£«é¡¿','æ‹‰æ–¯ç»´åŠ æ–¯','ä¼‘æ–¯é¡¿','åç››é¡¿DC','äºšç‰¹å…°å¤§','è¾¾æ‹‰æ–¯'],
  'æ—¥æœ¬':['ä¸œäº¬','å¤§é˜ª','äº¬éƒ½','ç¥æˆ·','æ¨ªæ»¨','åå¤å±‹','ç¦å†ˆ','æœ­å¹Œ','ä»™å°','å¥ˆè‰¯'],
  'éŸ©å›½':['é¦–å°”','é‡œå±±','ä»å·','å¤§é‚±','æµå·','å…‰å·'],
  'è‹±å›½':['ä¼¦æ•¦','æ›¼å½»æ–¯ç‰¹','çˆ±ä¸å ¡','åˆ©ç‰©æµ¦','ä¼¯æ˜ç¿°','å¸ƒé‡Œæ–¯æ‰˜'],
  'æ³•å›½':['å·´é»','é‡Œæ˜‚','é©¬èµ›','å°¼æ–¯','æ³¢å°”å¤š','æ–¯ç‰¹æ‹‰æ–¯å ¡'],
  'å¾·å›½':['æŸæ—','æ…•å°¼é»‘','æ±‰å ¡','æ³•å…°å…‹ç¦','ç§‘éš†','æœå¡å°”å¤šå¤«'],
  'æ„å¤§åˆ©':['ç½—é©¬','ç±³å…°','å¨å°¼æ–¯','ä½›ç½—ä¼¦è¨','é‚£ä¸å‹’æ–¯','éƒ½çµ'],
  'è¥¿ç­ç‰™':['é©¬å¾·é‡Œ','å·´å¡ç½—é‚£','å¡ç»´åˆ©äºš','ç“¦ä¼¦è¥¿äºš','æ¯•å°”å·´é„‚'],
  'ä¿„ç½—æ–¯':['è«æ–¯ç§‘','åœ£å½¼å¾—å ¡','å¶å¡æ·ç³å ¡','æ–°è¥¿ä¼¯åˆ©äºš'],
  'å°åº¦':['å­Ÿä¹°','æ–°å¾·é‡Œ','ç­åŠ ç½—å°”','æ¸…å¥ˆ','ç§‘å°”å¡å¡”','æµ·å¾—æ‹‰å·´'],
  'æ³°å›½':['æ›¼è°·','æ¸…è¿ˆ','èŠ­æé›…','æ™®å‰','åæ¬£'],
  'è¶Šå—':['æ²³å†…','èƒ¡å¿—æ˜å¸‚','å²˜æ¸¯','èŠ½åº„','ä¼šå®‰'],
  'è²å¾‹å®¾':['é©¬å°¼æ‹‰','å®¿åŠ¡','è¾¾æ²ƒ','é•¿æ»©å²›'],
  'æ¾³å¤§åˆ©äºš':['æ‚‰å°¼','å¢¨å°”æœ¬','å¸ƒé‡Œæ–¯ç­','ç€æ–¯','é»„é‡‘æµ·å²¸','é˜¿å¾·è±å¾·'],
  'å·´è¥¿':['åœ£ä¿ç½—','é‡Œçº¦çƒ­å†…å¢','è¨å°”ç“¦å¤š','å·´è¥¿åˆ©äºš','ç¦å¡”è±è¨'],
  'é˜¿æ ¹å»·':['å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯','ç§‘å°”å¤šç“¦','ç½—è¨é‡Œå¥¥','é—¨å¤šè¨'],
  'åŠ æ‹¿å¤§':['å¤šä¼¦å¤š','æ¸©å“¥å','è’™ç‰¹åˆ©å°”','å¡å°”åŠ é‡Œ','æ¸¥å¤ªå'],
  'åœŸè€³å…¶':['ä¼Šæ–¯å¦å¸ƒå°”','å®‰å¡æ‹‰','ä¼Šå…¹å¯†å°”','å®‰å¡”åˆ©äºš'],
  'å—é':['å¼€æ™®æ•¦','çº¦ç¿°å†…æ–¯å ¡','å¾·ç­','æ¯”å‹’é™€åˆ©äºš'],
  'å¢¨è¥¿å“¥':['å¢¨è¥¿å“¥åŸ','åæ˜†','ç“œè¾¾æ‹‰å“ˆæ‹‰','è’™ç‰¹é›·'],
};

// Country center in SVG 1000Ã—500 space
const cCoords={
  'ä¸­å›½':{x:714,y:150},'ç¾å›½':{x:215,y:152},'æ—¥æœ¬':{x:808,y:140},
  'éŸ©å›½':{x:793,y:141},'è‹±å›½':{x:450,y:103},'æ³•å›½':{x:462,y:126},
  'å¾·å›½':{x:482,y:108},'æ„å¤§åˆ©':{x:480,y:148},'è¥¿ç­ç‰™':{x:455,y:144},
  'ä¿„ç½—æ–¯':{x:620,y:80},'å°åº¦':{x:626,y:205},'æ³°å›½':{x:694,y:210},
  'è¶Šå—':{x:720,y:208},'è²å¾‹å®¾':{x:776,y:215},'æ¾³å¤§åˆ©äºš':{x:812,y:338},
  'å·´è¥¿':{x:278,y:290},'é˜¿æ ¹å»·':{x:264,y:375},'åŠ æ‹¿å¤§':{x:213,y:76},
  'åœŸè€³å…¶':{x:511,y:135},'å—é':{x:490,y:338},'å¢¨è¥¿å“¥':{x:197,y:207},
  'æ²™ç‰¹é˜¿æ‹‰ä¼¯':{x:527,y:182},'åŸƒåŠ':{x:502,y:175},'å°¼æ—¥åˆ©äºš':{x:470,y:232},
};

// City offsets from country center
const cityOff={
  'ä¸­å›½':{'åŒ—äº¬':[10,-15],'ä¸Šæµ·':[28,10],'å¹¿å·':[20,22],'æ·±åœ³':[23,25],'æˆéƒ½':[-16,10],'æ­å·':[26,8],'æ­¦æ±‰':[8,15],'è¥¿å®‰':[-10,8],'å—äº¬':[20,5],'é‡åº†':[-7,15],'å¤©æ´¥':[12,-12],'é’å²›':[28,0],'å¦é—¨':[28,18],'è‹å·':[24,6],'é•¿æ²™':[10,20],'æ²ˆé˜³':[18,-22],'éƒ‘å·':[3,4],'å“ˆå°”æ»¨':[15,-30]},
  'ç¾å›½':{'çº½çº¦':[42,5],'æ´›æ‰çŸ¶':[-28,18],'æ—§é‡‘å±±':[-32,10],'èŠåŠ å“¥':[16,0],'è¿ˆé˜¿å¯†':[30,30],'è¥¿é›…tle':[-34,-10],'è¥¿é›…å›¾':[-34,-10],'æ³¢å£«é¡¿':[44,2],'æ‹‰æ–¯ç»´åŠ æ–¯':[-20,15],'ä¼‘æ–¯é¡¿':[10,28],'åç››é¡¿DC':[38,8],'äºšç‰¹å…°å¤§':[24,22],'è¾¾æ‹‰æ–¯':[4,25]},
  'æ—¥æœ¬':{'ä¸œäº¬':[6,5],'å¤§é˜ª':[0,12],'äº¬éƒ½':[-2,10],'ç¥æˆ·':[-5,13],'æ¨ªæ»¨':[8,7],'åå¤å±‹':[2,10],'ç¦å†ˆ':[-6,15],'æœ­å¹Œ':[4,-10],'ä»™å°':[8,0],'å¥ˆè‰¯':[-1,11]},
  'éŸ©å›½':{'é¦–å°”':[0,-2],'é‡œå±±':[5,6],'ä»å·':[-3,-1],'å¤§é‚±':[3,4],'æµå·':[0,10],'å…‰å·':[-3,5]},
  'è‹±å›½':{'ä¼¦æ•¦':[2,8],'æ›¼å½»æ–¯ç‰¹':[-1,2],'çˆ±ä¸å ¡':[-2,-5],'åˆ©ç‰©æµ¦':[-3,3],'ä¼¯æ˜ç¿°':[0,5],'å¸ƒé‡Œæ–¯æ‰˜':[-2,7]},
  'æ³•å›½':{'å·´é»':[-1,-3],'é‡Œæ˜‚':[5,8],'é©¬èµ›':[8,14],'å°¼æ–¯':[12,13],'æ³¢å°”å¤š':[-6,8],'æ–¯ç‰¹æ‹‰æ–¯å ¡':[10,0]},
  'å¾·å›½':{'æŸæ—':[5,-5],'æ…•å°¼é»‘':[3,10],'æ±‰å ¡':[0,-8],'æ³•å…°å…‹ç¦':[-2,5],'ç§‘éš†':[-5,3],'æœå¡å°”å¤šå¤«':[-6,2]},
  'æ„å¤§åˆ©':{'ç½—é©¬':[3,8],'ç±³å…°':[-3,-5],'å¨å°¼æ–¯':[5,-2],'ä½›ç½—ä¼¦è¨':[2,5],'é‚£ä¸å‹’æ–¯':[6,18],'éƒ½çµ':[-5,-2]},
  'è¥¿ç­ç‰™':{'é©¬å¾·é‡Œ':[3,2],'å·´å¡ç½—é‚£':[12,-5],'å¡ç»´åˆ©äºš':[-3,10],'ç“¦ä¼¦è¥¿äºš':[8,5],'æ¯•å°”å·´é„‚':[0,-5]},
  'ä¿„ç½—æ–¯':{'è«æ–¯ç§‘':[-80,18],'åœ£å½¼å¾—å ¡':[-92,8],'å¶å¡æ·ç³å ¡':[-22,10],'æ–°è¥¿ä¼¯åˆ©äºš':[38,12]},
  'å°åº¦':{'å­Ÿä¹°':[-12,22],'æ–°å¾·é‡Œ':[-8,-5],'ç­åŠ ç½—å°”':[2,40],'æ¸…å¥ˆ':[18,38],'ç§‘å°”å¡å¡”':[25,15],'æµ·å¾—æ‹‰å·´':[8,30]},
  'æ³°å›½':{'æ›¼è°·':[5,5],'æ¸…è¿ˆ':[-2,-12],'èŠ­æé›…':[8,12],'æ™®å‰':[-2,22],'åæ¬£':[4,15]},
  'è¶Šå—':{'æ²³å†…':[0,-8],'èƒ¡å¿—æ˜å¸‚':[5,22],'å²˜æ¸¯':[3,8],'èŠ½åº„':[4,18],'ä¼šå®‰':[3,10]},
  'è²å¾‹å®¾':{'é©¬å°¼æ‹‰':[-2,2],'å®¿åŠ¡':[3,14],'è¾¾æ²ƒ':[5,22],'é•¿æ»©å²›':[-4,8]},
  'æ¾³å¤§åˆ©äºš':{'æ‚‰å°¼':[35,18],'å¢¨å°”æœ¬':[18,30],'å¸ƒé‡Œæ–¯ç­':[42,5],'ç€æ–¯':[-30,20],'é»„é‡‘æµ·å²¸':[44,12],'é˜¿å¾·è±å¾·':[2,22]},
  'å·´è¥¿':{'åœ£ä¿ç½—':[18,28],'é‡Œçº¦çƒ­å†…å¢':[22,22],'è¨å°”ç“¦å¤š':[35,15],'å·´è¥¿åˆ©äºš':[10,8],'ç¦å¡”è±è¨':[30,-5]},
  'é˜¿æ ¹å»·':{'å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯':[-2,8],'ç§‘å°”å¤šç“¦':[-5,-5],'ç½—è¨é‡Œå¥¥':[-3,0],'é—¨å¤šè¨':[-12,-8]},
  'åŠ æ‹¿å¤§':{'å¤šä¼¦å¤š':[45,25],'æ¸©å“¥å':[-55,18],'è’™ç‰¹åˆ©å°”':[55,20],'å¡å°”åŠ é‡Œ':[-20,15],'æ¸¥å¤ªå':[50,22]},
  'åœŸè€³å…¶':{'ä¼Šæ–¯å¦å¸ƒå°”':[-10,0],'å®‰å¡æ‹‰':[2,4],'ä¼Šå…¹å¯†å°”':[-12,6],'å®‰å¡”åˆ©äºš':[-2,12]},
  'å—é':{'å¼€æ™®æ•¦':[-8,22],'çº¦ç¿°å†…æ–¯å ¡':[5,2],'å¾·ç­':[18,10],'æ¯”å‹’é™€åˆ©äºš':[6,-2]},
  'å¢¨è¥¿å“¥':{'å¢¨è¥¿å“¥åŸ':[0,5],'åæ˜†':[22,8],'ç“œè¾¾æ‹‰å“ˆæ‹‰':[-8,5],'è’™ç‰¹é›·':[5,-8]},
};

let heatData={'ä¸­å›½':5,'ç¾å›½':5,'æ—¥æœ¬':4,'éŸ©å›½':5,'è‹±å›½':4,'æ³•å›½':4,'å¾·å›½':3,'æ„å¤§åˆ©':3,'æ³°å›½':4,'å°åº¦':3,'ä¿„ç½—æ–¯':2,'æ¾³å¤§åˆ©äºš':3,'å·´è¥¿':2,'è¶Šå—':3};
let formState={gender:null,event:null};
let totalCount=2847,todayCount=138;

// â”€â”€ STARFIELD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas=document.getElementById('starfield');
const ctx=canvas.getContext('2d');
let stars=[],W,H;
function initCanvas(){
  W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight;
  stars=Array.from({length:300},()=>({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.6+0.2,tw:Math.random()*Math.PI*2,ts:Math.random()*0.022+0.008,blue:Math.random()>0.85}));
}
function drawStars(){
  ctx.clearRect(0,0,W,H);
  stars.forEach(s=>{
    s.tw+=s.ts; const a=0.1+Math.abs(Math.sin(s.tw))*0.9;
    ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle=s.blue?`rgba(100,200,255,${a})`:`rgba(255,255,255,${a})`; ctx.fill();
    if(s.r>1.2){const g=ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,s.r*4);g.addColorStop(0,`rgba(150,220,255,${a*0.22})`);g.addColorStop(1,'transparent');ctx.beginPath();ctx.arc(s.x,s.y,s.r*4,0,Math.PI*2);ctx.fillStyle=g;ctx.fill();}
  });
}

// â”€â”€ ZOOM / PAN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const wrapper=document.getElementById('map-wrapper');
let sc=1,tx=0,ty=0,dragging=false,lx=0,ly=0;

function applyT(smooth=false){
  wrapper.classList.toggle('smooth',smooth);
  wrapper.style.transform=`translate(${tx}px,${ty}px) scale(${sc})`;
}

wrapper.addEventListener('wheel',e=>{
  e.preventDefault();
  sc=Math.min(Math.max(sc*(e.deltaY>0?0.84:1.19),0.5),10);
  applyT(false);
},{passive:false});

wrapper.addEventListener('mousedown',e=>{dragging=true;lx=e.clientX;ly=e.clientY;wrapper.classList.remove('smooth');});
window.addEventListener('mousemove',e=>{if(!dragging)return;tx+=e.clientX-lx;ty+=e.clientY-ly;lx=e.clientX;ly=e.clientY;applyT(false);});
window.addEventListener('mouseup',()=>dragging=false);

let ltd=0;
wrapper.addEventListener('touchstart',e=>{if(e.touches.length===1){dragging=true;lx=e.touches[0].clientX;ly=e.touches[0].clientY;}else if(e.touches.length===2){ltd=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);}},{passive:true});
wrapper.addEventListener('touchmove',e=>{
  if(e.touches.length===1&&dragging){tx+=e.touches[0].clientX-lx;ty+=e.touches[0].clientY-ly;lx=e.touches[0].clientX;ly=e.touches[0].clientY;applyT(false);}
  else if(e.touches.length===2){const d=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);sc=Math.min(Math.max(sc*(d/ltd),0.5),10);ltd=d;applyT(false);}
},{passive:true});
wrapper.addEventListener('touchend',()=>dragging=false);

function manualZoom(f){sc=Math.min(Math.max(sc*f,0.5),10);applyT(true);}
function resetZoom(){sc=1;tx=0;ty=0;applyT(true);}

function flyToCity(country,city){
  const pos=cCoords[country]; if(!pos) return;
  const off=(cityOff[country]||{})[city]||[0,0];
  const cx=pos.x+off[0], cy=pos.y+off[1];

  const svgW=wrapper.offsetWidth;
  const svgH=svgW*0.5; // 1000:500 ratio
  const toScreen=svgW/1000;

  // pixel position of target in wrapper (unscaled)
  const px=cx*toScreen;
  const py=cy*(svgH/500);

  const targetScale=4.8;
  // After scaling, wrapper center moves; we need to offset so target ends at screen center
  tx=window.innerWidth/2 - (wrapper.offsetLeft + px)*targetScale + wrapper.offsetLeft*(targetScale-1);
  ty=window.innerHeight/2 - (wrapper.offsetTop + py)*targetScale + wrapper.offsetTop*(targetScale-1);

  // Simpler reliable version: use wrapper's natural position
  const wRect=wrapper.getBoundingClientRect();
  const naturalLeft=(window.innerWidth-wrapper.offsetWidth)/2;
  const naturalTop=(window.innerHeight-wrapper.offsetHeight)/2;

  tx=(window.innerWidth/2)-(naturalLeft+px)*targetScale+naturalLeft;
  ty=(window.innerHeight/2)-(naturalTop+py)*targetScale+naturalTop;
  sc=targetScale;
  applyT(true);
}

// â”€â”€ SVG HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function el(tag,attrs){
  const e=document.createElementNS('http://www.w3.org/2000/svg',tag);
  Object.entries(attrs).forEach(([k,v])=>e.setAttribute(k,v)); return e;
}
function anim(attr,vals,dur,begin='0s'){
  return el('animate',{attributeName:attr,values:vals,dur:dur+'s',begin,repeatCount:'indefinite'});
}

// â”€â”€ HEAT LAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function heatColor(h){
  if(h>=5)return{core:'#ff4d8d',glow:'rgba(255,50,100,0.52)'};
  if(h>=4)return{core:'#ff9500',glow:'rgba(255,120,0,0.42)'};
  if(h>=3)return{core:'#ffd700',glow:'rgba(255,200,0,0.35)'};
  return{core:'#00d4ff',glow:'rgba(0,200,255,0.28)'};
}

function renderHeat(){
  const layer=document.getElementById('heat-layer'); layer.innerHTML='';
  Object.entries(heatData).forEach(([c,h])=>{
    const pos=cCoords[c]; if(!pos) return;
    const col=heatColor(h), r=6+h*4;
    const ring=el('circle',{cx:pos.x,cy:pos.y,r:r*2,fill:col.glow,filter:'url(#glow)'});
    ring.appendChild(anim('r',`${r*1.4};${r*3};${r*1.4}`,1.8+Math.random()));
    ring.appendChild(anim('opacity','0.22;0.52;0.22',1.8+Math.random()));
    layer.appendChild(ring);
    const core=el('circle',{cx:pos.x,cy:pos.y,r,fill:col.core,filter:'url(#sglow)'});
    core.appendChild(anim('opacity','0.5;1;0.5',0.9+Math.random()*0.5));
    layer.appendChild(core);
    if(h>=4) for(let i=0;i<Math.min(Math.round(h),8);i++){
      const a=(i/h)*Math.PI*2,d=r*2+Math.random()*9;
      const sp=el('circle',{cx:pos.x+Math.cos(a)*d,cy:pos.y+Math.sin(a)*d,r:1.3,fill:col.core});
      sp.appendChild(anim('opacity','0;1;0',0.6+Math.random()*0.7,(Math.random()*2.2)+'s'));
      layer.appendChild(sp);
    }
    if(h>=4){
      const lbl=el('text',{x:pos.x,y:pos.y-r-4,'text-anchor':'middle',fill:col.core,'font-size':'5.5','font-family':'Noto Sans SC',opacity:'0.88'});
      lbl.textContent=c; layer.appendChild(lbl);
    }
  });
}

function genMapStars(){
  const l=document.getElementById('map-stars'); l.innerHTML='';
  for(let i=0;i<100;i++){
    const c=el('circle',{cx:Math.random()*1000,cy:Math.random()*500,r:Math.random()*1.3+0.2,fill:'white'});
    c.appendChild(anim('opacity','0.04;1;0.04',1.5+Math.random()*2.5,(Math.random()*3)+'s'));
    l.appendChild(c);
  }
}

// â”€â”€ FLASH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function flashPoint(x,y,label){
  const layer=document.getElementById('flash-layer');
  for(let i=0;i<4;i++){
    const ring=el('circle',{cx:x,cy:y,r:0,fill:'none',stroke:'#ff4d8d','stroke-width':i<2?'2.5':'1.2',opacity:1,filter:'url(#mglow)'});
    layer.appendChild(ring);
    setTimeout(()=>{
      let st=null;
      (function a(ts){if(!st)st=ts;const p=Math.min((ts-st)/1900,1);ring.setAttribute('r',p*95);ring.setAttribute('opacity',1-p);p<1?requestAnimationFrame(a):ring.remove();})(performance.now());
    },i*170);
  }
  const burst=el('circle',{cx:x,cy:y,r:4,fill:'#ff4d8d',filter:'url(#mglow)',opacity:0});
  layer.appendChild(burst);
  let bs=null;
  (function a(ts){if(!bs)bs=ts;const p=Math.min((ts-bs)/1000,1);burst.setAttribute('opacity',p<0.2?p/0.2:1-(p-0.2)/0.8);burst.setAttribute('r',4+p*38);p<1?requestAnimationFrame(a):burst.remove();})(performance.now());
  const txt=el('text',{x,y:y-26,'text-anchor':'middle',fill:'#ff4d8d','font-size':'8','font-family':'Orbitron',filter:'url(#glow)'});
  txt.textContent='âš¡ '+label+' âš¡'; layer.appendChild(txt);
  let ls=null;
  (function a(ts){if(!ls)ls=ts;const p=Math.min((ts-ls)/2400,1);txt.setAttribute('opacity',p<0.08?p/0.08:p>0.72?(1-p)/0.28:1);txt.setAttribute('y',y-26-p*24);p<1?requestAnimationFrame(a):txt.remove();})(performance.now());
}

// â”€â”€ DANMU â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const emos={'å¤±è”':'ğŸ‘»','æš§æ˜§å¤šçº¿':'ğŸ’”','ç”»é¥¼':'ğŸ¥§','å·²è¯»ä¸å›':'ğŸ“µ','PUA':'ğŸ­','åˆ†æ‰‹ç”©é”…':'ğŸŒ€'};
const evList=['å¤±è”','æš§æ˜§å¤šçº¿','ç”»é¥¼','å·²è¯»ä¸å›','PUA','åˆ†æ‰‹ç”©é”…'];
const danmuCities=['ä¼¦æ•¦','ä¸œäº¬','é¦–å°”','å·´é»','ä¸Šæµ·','çº½çº¦','æ›¼è°·','æ‚‰å°¼','åŒ—äº¬','æ´›æ‰çŸ¶','æŸæ—','é©¬å¾·é‡Œ','æ·±åœ³','å¤§é˜ª','æ–°åŠ å¡','å¤šä¼¦å¤š','é‡Œçº¦','å­Ÿä¹°','é›…å…¸','è¿ªæ‹œ','æˆéƒ½','é‡œå±±'];
const genderList=['æ¸£ç”·','æ¸£å¥³'];
const dc=document.getElementById('danmu-canvas');

const danmuTemplates=[
  (city,ev,g,em)=>`${em} åˆšæ‰æœ‰ä¸€ä½${city}ç”¨æˆ·æ ‡è®°äº†ã€Œ${ev}ã€`,
  (city,ev,g,em)=>`âš  ${city} Â· ${g} Â· ${ev} é¢„è­¦`,
  (city,ev,g,em)=>`ğŸ’€ ${city}æ–°å¢ ${ev} é¿é›·è®°å½•`,
  (city,ev,g,em)=>`ğŸ“ ${city}ç”¨æˆ·æäº¤äº†é¿é›·åæ ‡`,
  (city,ev,g,em)=>`${em} ${g}è­¦æŠ¥ Â· ${city} Â· ${ev}`,
  (city,ev,g,em)=>`ğŸ›° ç³»ç»Ÿç›‘æµ‹åˆ°${city}é™„è¿‘æœ‰${ev}è¡Œä¸º`,
  (city,ev,g,em)=>`âš¡ é¿é›·æé†’ï¼š${city}å‡ºç°${g}${ev}`,
];

function spawnDanmu(overrideText=null,urgent=false){
  const ev=evList[Math.floor(Math.random()*evList.length)];
  const city=danmuCities[Math.floor(Math.random()*danmuCities.length)];
  const g=genderList[Math.floor(Math.random()*genderList.length)];
  const em=emos[ev];
  const txt=overrideText||(danmuTemplates[Math.floor(Math.random()*danmuTemplates.length)])(city,ev,g,em);
  const type=urgent?'pink':Math.random()>0.75?'pink':Math.random()>0.6?'gold':'';
  const d=document.createElement('div');
  d.className='danmu'+(type?' '+type:'');

  const useVert=!urgent&&Math.random()>0.72;
  if(useVert){
    d.classList.add('vert');
    const side=Math.random()>0.5;
    d.style[side?'right':'left']=(6+Math.random()*28)+'px';
    d.style.bottom='-160px';
    const dur=13+Math.random()*9;
    d.style.animation=`danmu-up ${dur}s linear forwards`;
    d.style.setProperty('--dur',dur+'s');
    d.textContent=txt;
    dc.appendChild(d);
    // keyframe via JS
    const id='du_'+Date.now()+Math.random();
    d.style.animationName=id;
    const sh=document.createElement('style');
    sh.textContent=`@keyframes ${id}{from{opacity:0;transform:translateY(0);}5%{opacity:1;}90%{opacity:0.75;}to{opacity:0;transform:translateY(-${window.innerHeight+200}px);}}`;
    document.head.appendChild(sh);
    setTimeout(()=>{d.remove();sh.remove();},dur*1000+300);
  } else {
    const laneH=window.innerHeight/14;
    const lane=Math.floor(Math.random()*14);
    const topY=lane*laneH+laneH*0.1+Math.random()*laneH*0.6;
    d.style.top=topY+'px';
    d.style.right='-500px';
    const dur=urgent?9:11+Math.random()*8;
    if(urgent){d.style.fontSize='13px';d.style.boxShadow='0 0 14px rgba(255,77,141,0.3)';}
    d.textContent=txt;
    dc.appendChild(d);
    const id='dh_'+Date.now()+Math.random();
    d.style.animationName=id;
    const sh=document.createElement('style');
    sh.textContent=`@keyframes ${id}{from{opacity:0;transform:translateX(0);}4%{opacity:1;}88%{opacity:0.8;}to{opacity:0;transform:translateX(-${window.innerWidth+600}px);}}`;
    document.head.appendChild(sh);
    d.style.animationDuration=dur+'s';
    d.style.animationTimingFunction='linear';
    d.style.animationFillMode='forwards';
    setTimeout(()=>{d.remove();sh.remove();},dur*1000+300);
  }
}

setInterval(()=>spawnDanmu(),1900);
setTimeout(()=>{for(let i=0;i<6;i++)setTimeout(()=>spawnDanmu(),i*700);},400);

// â”€â”€ TOOLTIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tip=document.getElementById('tip');
document.querySelectorAll('.country').forEach(p=>{
  p.style.cursor='pointer';
  p.addEventListener('mouseenter',function(e){
    const c=this.dataset.country,h=heatData[c]||0;
    tip.innerHTML=`${c} Â· é£é™© ${Math.round(h)}/8 Â· ${Math.floor(h*190+40)} æ¡è®°å½•`;
    tip.style.opacity='1'; this.style.fill='rgba(0,75,155,0.88)';
  });
  p.addEventListener('mousemove',e=>{tip.style.left=(e.clientX+14)+'px';tip.style.top=(e.clientY-32)+'px';});
  p.addEventListener('mouseleave',function(){tip.style.opacity='0';this.style.fill='';});
});

// â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(){document.getElementById('modal').classList.add('active');}
function closeModal(){document.getElementById('modal').classList.remove('active');}
document.getElementById('modal').addEventListener('click',function(e){if(e.target===this)closeModal();});

function selectGender(g){
  formState.gender=g;
  document.getElementById('btn-male').classList.toggle('sel',g==='ç”·');
  document.getElementById('btn-female').classList.toggle('sel',g==='å¥³');
}
function selectEvent(e){
  formState.event=e;
  document.querySelectorAll('.ebtn').forEach(b=>b.classList.remove('sel'));
  const m={'å¤±è”':'ev-lost','æš§æ˜§å¤šçº¿':'ev-multi','ç”»é¥¼':'ev-pie','å·²è¯»ä¸å›':'ev-read','PUA':'ev-pua','åˆ†æ‰‹ç”©é”…':'ev-blame'};
  document.getElementById(m[e]).classList.add('sel');
}
function onCountryChange(){
  const c=document.getElementById('sel-country').value;
  const cs=document.getElementById('sel-city');
  cs.innerHTML='<option value="">â€” é€‰æ‹©åŸå¸‚ â€”</option>';
  (cityData[c]||[]).forEach(x=>{const o=document.createElement('option');o.value=x;o.textContent=x;cs.appendChild(o);});
}

function submitReport(){
  const country=document.getElementById('sel-country').value;
  const city=document.getElementById('sel-city').value;
  if(!formState.gender||!formState.event||!country||!city){showNotif('âš  è¯·å®Œæ•´å¡«å†™æ‰€æœ‰é€‰é¡¹');return;}

  heatData[country]=Math.min((heatData[country]||1)+1.3,9);
  totalCount++;todayCount++;
  document.getElementById('total-count').textContent=totalCount.toLocaleString();
  document.getElementById('today-count').textContent=todayCount;

  closeModal();
  renderHeat();
  flyToCity(country,city);

  const pos=cCoords[country];
  const off=(cityOff[country]||{})[city]||[0,0];
  if(pos) setTimeout(()=>flashPoint(pos.x+off[0],pos.y+off[1],country+'Â·'+city),1100);

  // Urgent danmu
  const em=emos[formState.event]||'âš¡';
  setTimeout(()=>spawnDanmu(`${em} åˆšæ‰æœ‰äººåœ¨${city}æ ‡è®°äº†ã€Œ${formState.event}ã€Â· è¯·æ³¨æ„é˜²èŒƒ`,true),600);

  showNotif(`ğŸ’¢ åæ ‡å·²æŠ•é€’ï¼š${country} Â· ${city}`);

  // reset
  formState={gender:null,event:null};
  document.querySelectorAll('.gbtn,.ebtn').forEach(b=>b.classList.remove('sel'));
  document.getElementById('sel-country').value='';
  document.getElementById('sel-city').innerHTML='<option value="">â€” è¯·å…ˆé€‰æ‹©å›½å®¶ â€”</option>';
}

function showNotif(msg){
  const n=document.getElementById('notif');
  n.textContent=msg;n.classList.add('show');
  setTimeout(()=>n.classList.remove('show'),3200);
}

// â”€â”€ LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loop(){drawStars();requestAnimationFrame(loop);}
window.addEventListener('resize',initCanvas);
initCanvas(); genMapStars(); renderHeat(); loop();

setInterval(()=>{
  const cs=Object.keys(heatData),r=cs[Math.floor(Math.random()*cs.length)];
  if(heatData[r]<7.5)heatData[r]+=0.04;
  renderHeat();
  totalCount+=Math.floor(Math.random()*3);
  document.getElementById('total-count').textContent=totalCount.toLocaleString();
},5000);

setTimeout(()=>document.getElementById('zhint').style.opacity='0',6000);
</script>
</body>
</html>
